
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>EO Signals - Trade Smart</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <script defer src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script defer src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
  <script defer src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
  <style>
    body {
      margin: 0;
      font-family: 'Segoe UI', sans-serif;
      background-color: #111;
      color: #fff;
    }
    .page { display: none; padding: 1rem; }
    .active { display: block; }
    .loader {
      position: fixed;
      top: 0; left: 0;
      width: 100%; height: 100%;
      background: #000;
      color: gold;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 24px;
      z-index: 9999;
    }
    .btn {
      background: gold;
      color: black;
      padding: 10px;
      border: none;
      border-radius: 8px;
      margin-top: 10px;
      font-weight: bold;
      cursor: pointer;
    }
    .signal-card {
      background: #1a1a1a;
      border-left: 4px solid gold;
      padding: 1rem;
      margin-bottom: 1rem;
      border-radius: 10px;
      position: relative;
    }
    .signal-card.locked {
      opacity: 0.4;
    }
    .signal-card.locked::after {
      content: "üîí Locked - 1 EO Coin";
      position: absolute;
      top: 40%;
      left: 20%;
      color: gold;
      font-weight: bold;
    }
    input, select {
      width: 100%;
      padding: 10px;
      margin: 10px 0;
      border-radius: 6px;
      border: none;
    }
    .nav {
      position: fixed;
      bottom: 0;
      width: 100%;
      background: #222;
      display: flex;
      justify-content: space-around;
      border-top: 2px solid gold;
      padding: 0.5rem 0;
    }
    .nav a {
      color: gold;
      font-weight: bold;
      text-decoration: none;
    }
    .header {
      font-size: 24px;
      margin-bottom: 1rem;
      color: gold;
    }
  </style>
</head>
<body>
  <div id="loader" class="loader">Loading EO Signals...</div>

  <!-- Auth Page -->
  <div id="auth" class="page active">
    <div class="header">üîê Login to EO Signals</div>
    <input type="email" id="email" placeholder="Email" />
    <input type="password" id="password" placeholder="Password" />
    <button class="btn" onclick="login()">Login</button>
    <button class="btn" onclick="register()">Register</button>
  </div>

  <!-- Home Page -->
  <div id="home" class="page">
    <div class="header">üìä Signals</div>
    <input id="searchBar" placeholder="Search by asset (e.g., Gold)" oninput="filterSignals()" />
    <div id="signalsList"></div>
  </div>

  <!-- Profile Page -->
  <div id="profile" class="page">
    <div class="header">üë§ My Account</div>
    <p><strong>Email:</strong> <span id="userEmail"></span></p>
    <p><strong>EO Coin Balance:</strong> <span id="walletBalance">0</span> ü™ô</p>
    <p><strong>Subscription:</strong> <span id="subExpiry">None</span></p>
    <button class="btn" onclick="logout()">Logout</button>
  </div>

  <!-- Subscribe Page -->
  <div id="subscribe" class="page">
    <div class="header">üí≥ Deposit</div>
    <p>üí∞ Buy EO Coins to unlock signals (1 signal = 1 EO Coin).</p>
    <a class="btn" href="https://paystack.com/buy/eo-signals-zstlfg">Deposit Now</a>
    <p style="color:red; font-size:13px;">‚ùó No refunds after payment</p>
  </div>

  <!-- Navigation -->
  <div class="nav">
    <a href="#" onclick="nav('home')">Home</a>
    <a href="#" onclick="nav('subscribe')">Deposit</a>
    <a href="#" onclick="nav('profile')">Account</a>
  </div>

  <script>
    setTimeout(() => {
      document.getElementById("loader").style.display = "none";
    }, 3000);

    const firebaseConfig = {
      apiKey: "AIzaSyC_48KAtbyUk_658IKKPVVkdKF32F4xDHs",
      authDomain: "eo-signals.firebaseapp.com",
      projectId: "eo-signals",
      appId: "1:1045274402025:web:a5c4913b9f6e390162e478"
    };
    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.firestore();

    function showPage(id) {
      document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
      document.getElementById(id).classList.add('active');
    }

    function nav(id) {
      showPage(id);
    }

    function register() {
      const email = document.getElementById("email").value;
      const pass = document.getElementById("password").value;
      auth.createUserWithEmailAndPassword(email, pass)
        .then(async cred => {
          await db.collection("users").doc(cred.user.uid).set({
            email,
            wallet: 0,
            unlockedSignals: [],
            subscription_expiry: ""
          });
        })
        .catch(e => alert("‚ùå " + e.message));
    }

    function login() {
      const email = document.getElementById("email").value;
      const pass = document.getElementById("password").value;
      auth.signInWithEmailAndPassword(email, pass)
        .then(() => showPage("home"))
        .catch(e => alert("Login failed: " + e.message));
    }

    function logout() {
      auth.signOut().then(() => showPage("auth"));
    }

    auth.onAuthStateChanged(async user => {
      if (user) {
        const doc = await db.collection("users").doc(user.uid).get();
        if (!doc.exists) {
          alert("Not registered.");
          auth.signOut();
          return;
        }
        showPage("home");
        loadSignals();
        loadProfile();
      }
    });

    async function loadProfile() {
      const user = auth.currentUser;
      const doc = await db.collection("users").doc(user.uid).get();
      const data = doc.data();
      document.getElementById("userEmail").innerText = data.email;
      document.getElementById("walletBalance").innerText = data.wallet;
      document.getElementById("subExpiry").innerText = data.subscription_expiry || "None";
    }

    let allSignals = [];

    async function loadSignals() {
      const snapshot = await db.collection("signals").orderBy("date", "desc").get();
      allSignals = snapshot.docs.map(d => d.data());
      renderSignals();
    }

    async function renderSignals() {
      const user = auth.currentUser;
      const doc = await db.collection("users").doc(user.uid).get();
      const userData = doc.data();
      const unlocked = userData.unlockedSignals || [];
      const isSubscribed = userData.subscription_expiry && new Date(userData.subscription_expiry) > new Date();

      const list = document.getElementById("signalsList");
      list.innerHTML = "";

      allSignals.forEach(sig => {
        const hasAccess = isSubscribed || unlocked.includes(sig.id);
        const div = document.createElement("div");
        div.className = "signal-card" + (hasAccess ? "" : " locked");
        div.innerHTML = `
          <strong>${sig.asset} ‚Äì ${sig.action}</strong><br>
          Entry: ${sig.entry} | TP: ${sig.tp} | SL: ${sig.sl}<br>
          ‚è±Ô∏è Duration: ${sig.duration}<br>
          ${!hasAccess ? `<button class="btn" onclick="unlockSignal('${sig.id}')">Unlock for 1 EO Coin</button>` : ""}
        `;
        list.appendChild(div);
      });
    }

    function filterSignals() {
      const search = document.getElementById("searchBar").value.toLowerCase();
      allSignals = allSignals.filter(s => s.asset.toLowerCase().includes(search));
      renderSignals();
    }

    async function unlockSignal(id) {
      const uid = auth.currentUser.uid;
      const ref = db.collection("users").doc(uid);
      const doc = await ref.get();
      const data = doc.data();
      if (data.wallet >= 1) {
        await ref.update({
          wallet: data.wallet - 1,
          unlockedSignals: firebase.firestore.FieldValue.arrayUnion(id)
        });
        alert("‚úÖ Signal unlocked!");
        loadProfile();
        renderSignals();
      } else {
        alert("‚ùå Not enough EO Coins. Please deposit.");
      }
    }
  </script>
  
<div id="adminPanel" class="page">
  <div class="header">üõ†Ô∏è Admin Panel</div>

  <h3>Post Signal</h3>
  <input id="asset" placeholder="Asset (e.g., EUR/USD)" />
  <input id="action" placeholder="Action (Buy/Sell)" />
  <input id="entry" placeholder="Entry Price" />
  <input id="tp" placeholder="Take Profit" />
  <input id="sl" placeholder="Stop Loss" />
  <button class="btn" onclick="postSignal()">Post Signal</button>

  <h3 style="margin-top:30px;">Transfer EO Coins</h3>
  <input id="targetEmail" placeholder="User Email" />
  <input id="coinAmount" type="number" placeholder="Amount to send" />
  <button class="btn" onclick="transferCoins()">Send Coins</button>
  <p style="margin-top:10px;">Admin Wallet Balance: <span id="adminBalance">Loading...</span> ü™ô</p>
</div>

<script>
  const adminEmail = "eluxxes@gmail.com";
  const ADMIN_WALLET_ID = "eo";

  async function postSignal() {
    const asset = document.getElementById("asset").value;
    const action = document.getElementById("action").value;
    const entry = document.getElementById("entry").value;
    const tp = document.getElementById("tp").value;
    const sl = document.getElementById("sl").value;
    const id = `${asset.toLowerCase().replace(/[^a-z]/g, '')}_${Date.now()}`;

    await db.collection("signals").doc(id).set({
      id,
      asset,
      action,
      entry,
      tp,
      sl,
      duration: "3 minutes",
      date: new Date().toISOString().split("T")[0]
    });

    alert("‚úÖ Signal posted!");
  }

  async function transferCoins() {
    const email = document.getElementById("targetEmail").value;
    const amount = parseInt(document.getElementById("coinAmount").value);
    if (!email || !amount || amount <= 0) {
      alert("Invalid input.");
      return;
    }

    // Get user by email
    const snap = await db.collection("users").where("email", "==", email).get();
    if (snap.empty) return alert("User not found.");

    const userDoc = snap.docs[0];
    const userId = userDoc.id;
    const userData = userDoc.data();

    // Get admin balance
    const adminRef = db.collection("adminWallet").doc(ADMIN_WALLET_ID);
    const adminDoc = await adminRef.get();
    let balance = adminDoc.exists ? adminDoc.data().balance : 60000000;

    if (amount > balance) return alert("‚ùå Admin does not have enough coins.");

    // Update both balances
    await adminRef.set({ balance: balance - amount });
    await db.collection("users").doc(userId).update({
      wallet: (userData.wallet || 0) + amount
    });

    alert(`‚úÖ Sent ${amount} EO Coins to ${email}`);
    loadAdminWallet();
  }

  async function loadAdminWallet() {
    const ref = db.collection("adminWallet").doc(ADMIN_WALLET_ID);
    const doc = await ref.get();
    const data = doc.exists ? doc.data() : { balance: 60000000 };
    if (!doc.exists) await ref.set(data); // Create if missing
    document.getElementById("adminBalance").innerText = data.balance;
  }

  auth.onAuthStateChanged(user => {
    if (user && user.email === adminEmail) {
      const adminTab = document.createElement("a");
      adminTab.innerText = "Admin";
      adminTab.href = "#";
      adminTab.onclick = () => showPage("adminPanel");
      document.querySelector(".nav").appendChild(adminTab);
      loadAdminWallet();
    }
  });
</script>
</body>
</html>
